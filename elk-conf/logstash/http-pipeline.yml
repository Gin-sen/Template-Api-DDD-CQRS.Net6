input {
    http {
        id => "http"
        port => 6044
        codec => json
        add_field => { "[@metadata][x_environment]" => "%{[header][x_environment]}"}
    }
}

## Add your filters / logstash plugins configuration here
filter {
    mutate {
        if [@metadata][x_environment] in [ "test", "dev", "inte", "preprod", "recette" ] {
            add_field => { "[@metadata][target_environment]" => "dev" }
        } else if [@metadata][x_environment] == "production" {
            add_field => { "[@metadata][target_environment]" => "prod" }
        } else {
            add_field => { "[@metadata][target_environment]" => "unknown" }
        }
    }
}

output {
    pipeline { send_to => [commonOut] }
}


#output {
#    elasticsearch {
#        hosts => ["http://elasticsearch:9200"]
#        user => "logstash_internal"
#        password => "${LOGSTASH_INTERNAL_PASSWORD}"
#        data_stream => "true"
#        data_stream_dataset => "generic-%{[@metadata][target_environment]}"
#        data_stream_namespace => "default"
#        data_stream_type => "logs"
#    }
#}